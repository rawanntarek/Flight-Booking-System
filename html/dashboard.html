<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <!-- Link to your existing CSS files -->
    <link rel="stylesheet" href="../css/Dashboard.css">
    <link rel="stylesheet" href="../css/company_home.css"> 
    <style>
      
        /* Dynamically set the logo image using a CSS variable */
        .welcomeback::before {
            content: '';
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: inline-block;
            background-image: var(--user-photo);
            background-size: cover;
            background-position: center;
            margin-right: 10px; /* Space between logo and text */
            vertical-align: middle;
        }

        /* Adjust the welcomeback div to align items properly */
        .welcomeback {
            display: flex;
            align-items: center;
        }

        /* Styling for the user name */
        #company-name {
            margin: 0;
            font-size: 1.5em;
            font-weight: bold;
        }

        /* Error Message Styling */
        .error-message {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <ul>
            <li><a href="../php/controllers/profile.php" class="button">View Profile</a></li>
            <li><a href="../php/controllers/my_bookings.php" class="button">My Bookings</a></li>
            <li><a href="../php/controllers/logout.php" class="button">Logout</a></li>
        </ul>
        <br><br>

        <div class="welcomeback">
            <h2>Welcome Back</h2>
            <p id="company-name">Loading...</p>
        </div>

        <div class="tagline">
            <p>Explore the skies with ease</p>
            <p>Book your next adventure today!</p>
        </div>
           
        <div class="search-section">
            <form method="GET" action="../php/controllers/search_flight.php" class="search-form">
                <label for="from">From:</label>
                <input type="text" id="from" name="from" placeholder="Enter departure location">

                <label for="to">To:</label>
                <input type="text" id="to" name="to" placeholder="Enter destination location">
                <br>
                <input type="submit" value="Search">
            </form>
        </div>

        <!-- Error Message Container -->
        <div id="error-container" class="error-message"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Fetch user data from dashboard.php
            fetch('../php/controllers/user/dashboard.php')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok: ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        // Handle errors returned by dashboard.php
                        console.error('Error:', data.error);
                        document.getElementById('company-name').textContent = 'Error loading user data';
                        document.getElementById('error-container').textContent = data.error;
                        return;
                    }

                    // Set the user name
                    document.getElementById('company-name').textContent = data.user_name;

                    // Update the CSS variable for the background image
                    document.documentElement.style.setProperty('--user-photo', `url('${data.photo_path}')`);
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    document.getElementById('company-name').textContent = 'Error loading user data';
                    document.getElementById('error-container').textContent = 'Unable to load user data. Please try again later.';
                });
        });
    </script>
</body>
</html>
